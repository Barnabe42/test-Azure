{
	"info": {
		"name": "Azure Storage API",
		"_postman_id": "5b1a63a0-642d-4a8b-9e0f-df185b1cb443",
		"description": "The REST APIs for the Microsoft Azure storage services offer programmatic access to the Blob, Queue, Table, and File services in Azure or in the development environment, via the storage emulator.    \n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/azure-storage-services-rest-api-reference)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Queue",
			"description": "Microsoft Azure Storage provides REST operations for working with messages in message queues.\n\n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/operations-on-messages)",
			"item": [
				{
					"name": "Get Messages",
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://{{storageAccountName}}.queue.core.windows.net/{{storageQueueName}}/messages?sv={{storageSasTokenQueryString}}&numofmessages=1",
							"protocol": "https",
							"host": [
								"{{storageAccountName}}",
								"queue",
								"core",
								"windows",
								"net"
							],
							"path": [
								"{{storageQueueName}}",
								"messages"
							],
							"query": [
								{
									"key": "sv",
									"value": "{{storageSasTokenQueryString}}",
									"equals": true,
									"description": "SAS token query string generated in pre-request script in collection"
								},
								{
									"key": "numofmessages",
									"value": "1",
									"equals": true,
									"description": "Optional. A nonzero integer value that specifies the number of messages to retrieve from the queue, up to a maximum of 32"
								}
							]
						},
						"description": "The Get Messages operation retrieves one or more messages from the front of the queue. \n\n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/get-messages)"
					},
					"response": []
				},
				{
					"name": "Peek Messages",
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://{{storageAccountName}}.queue.core.windows.net/{{storageQueueName}}/messages?sv={{storageSasTokenQueryString}}&numofmessages=1&peekonly=true",
							"protocol": "https",
							"host": [
								"{{storageAccountName}}",
								"queue",
								"core",
								"windows",
								"net"
							],
							"path": [
								"{{storageQueueName}}",
								"messages"
							],
							"query": [
								{
									"key": "sv",
									"value": "{{storageSasTokenQueryString}}",
									"equals": true,
									"description": "SAS token query string generated in pre-request script in collection"
								},
								{
									"key": "numofmessages",
									"value": "1",
									"equals": true,
									"description": "Optional. A nonzero integer value that specifies the number of messages to retrieve from the queue, up to a maximum of 32"
								},
								{
									"key": "peekonly",
									"value": "true",
									"equals": true
								}
							]
						},
						"description": "This operation retrieves one or more messages from the front of the queue, but does not alter the visibility of the message. \r\n\r\n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/peek-messages)"
					},
					"response": []
				},
				{
					"name": "Put Message",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/xml"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "<QueueMessage>  \r\n    <MessageText>\r\n    \tHello World!\r\n    </MessageText>  \r\n</QueueMessage>  "
						},
						"url": {
							"raw": "https://{{storageAccountName}}.queue.core.windows.net/{{storageQueueName}}/messages?sv={{storageSasTokenQueryString}}",
							"protocol": "https",
							"host": [
								"{{storageAccountName}}",
								"queue",
								"core",
								"windows",
								"net"
							],
							"path": [
								"{{storageQueueName}}",
								"messages"
							],
							"query": [
								{
									"key": "sv",
									"value": "{{storageSasTokenQueryString}}",
									"equals": true,
									"description": "SAS token query string generated in pre-request script in collection"
								}
							]
						},
						"description": "The Put Message operation adds a new message to the back of the message queue. \n\n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/put-message)"
					},
					"response": []
				},
				{
					"name": "Delete Message",
					"request": {
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://{{storageAccountName}}.queue.core.windows.net/{{storageQueueName}}/messages?sv={{storageSasTokenQueryString}}&popreceipt=",
							"protocol": "https",
							"host": [
								"{{storageAccountName}}",
								"queue",
								"core",
								"windows",
								"net"
							],
							"path": [
								"{{storageQueueName}}",
								"messages"
							],
							"query": [
								{
									"key": "sv",
									"value": "{{storageSasTokenQueryString}}",
									"equals": true,
									"description": "SAS token query string generated in pre-request script in collection"
								},
								{
									"key": "popreceipt",
									"value": "",
									"equals": true,
									"description": "Required. A valid pop receipt value returned from an earlier call to the Get Messages or Update Message operation."
								}
							]
						},
						"description": "The Delete Message operation deletes the specified message. \n\n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/delete-message2)"
					},
					"response": []
				},
				{
					"name": "Clear Messages",
					"request": {
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://{{storageAccountName}}.queue.core.windows.net/{{storageQueueName}}/messages?sv={{storageSasTokenQueryString}}",
							"protocol": "https",
							"host": [
								"{{storageAccountName}}",
								"queue",
								"core",
								"windows",
								"net"
							],
							"path": [
								"{{storageQueueName}}",
								"messages"
							],
							"query": [
								{
									"key": "sv",
									"value": "{{storageSasTokenQueryString}}",
									"equals": true,
									"description": "SAS token query string generated in pre-request script in collection"
								}
							]
						},
						"description": "The Clear Messages operation deletes all messages from the specified queue. \n\n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/clear-messages)"
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "8c0605db-bcd4-49ba-b642-6936e3a74c89",
						"type": "text/javascript",
						"exec": [
							"const storageQueueName = \"\";",
							"",
							"pm.variables.set(\"storageQueueName\", storageQueueName);"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "6647b32f-1730-499e-978c-fc73b6851697",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Blob",
			"description": "The REST API for the Blob service defines HTTP operations against container and blob resources. \n\n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/blob-service-rest-api)",
			"item": [
				{
					"name": "Get Blob",
					"request": {
						"method": "GET",
						"header": [],
						"body": {},
						"url": {
							"raw": "https://{{storageAccountName}}.blob.core.windows.net/{{storageContainerName}}/{{storageBlobName}}?sv={{storageSasTokenQueryString}}",
							"protocol": "https",
							"host": [
								"{{storageAccountName}}",
								"blob",
								"core",
								"windows",
								"net"
							],
							"path": [
								"{{storageContainerName}}",
								"{{storageBlobName}}"
							],
							"query": [
								{
									"key": "sv",
									"value": "{{storageSasTokenQueryString}}",
									"equals": true
								}
							]
						},
						"description": "The Get Blob operation reads or downloads a blob from the system, including its metadata and properties. You can also call Get Blob to read a snapshot.    \n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/get-blob)"
					},
					"response": []
				},
				{
					"name": "Put Blob",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "x-ms-blob-type",
								"value": "BlockBlob",
								"description": "Required. Specifies the type of blob to create: BlockBlob, PageBlob, or AppendBlob. "
							}
						],
						"body": {},
						"url": {
							"raw": "https://{{storageAccountName}}.blob.core.windows.net/{{storageContainerName}}/{{storageBlobName}}?sv={{storageSasTokenQueryString}}",
							"protocol": "https",
							"host": [
								"{{storageAccountName}}",
								"blob",
								"core",
								"windows",
								"net"
							],
							"path": [
								"{{storageContainerName}}",
								"{{storageBlobName}}"
							],
							"query": [
								{
									"key": "sv",
									"value": "{{storageSasTokenQueryString}}",
									"equals": true
								}
							]
						},
						"description": "The Put Blob operation creates a new block, page, or append blob, or updates the content of an existing block blob.    \n[Documentation](https://docs.microsoft.com/en-us/rest/api/storageservices/put-blob)"
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "08e920fa-7970-4bc1-b96a-3dfb0f2f49db",
						"type": "text/javascript",
						"exec": [
							"const storageContainerName = \"\";",
							"const storageBlobName = \"\";",
							"",
							"pm.variables.set(\"storageContainerName\", storageContainerName);",
							"pm.variables.set(\"storageBlobName\", storageBlobName);"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "d9c0bc27-f657-4f98-ae45-e83183f42ec4",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "cd54c413-85bc-46e8-9a93-b3f6abe9a93a",
				"type": "text/javascript",
				"exec": [
					"const storageSasKey = pm.variables.get(\"storageSasKey\");",
					"const storageAccountName = pm.variables.get(\"storageAccountName\");",
					"const storageSasTokenQueryString = createStorageSASTokenQueryString(storageAccountName, storageSasKey);",
					"",
					"pm.variables.set(\"storageSasTokenQueryString\", storageSasTokenQueryString);",
					"",
					"",
					"/**",
					" * Create a Shared Access Signature (SAS) token query string valid for one minute for use with the Azure Storage REST API",
					" * @param accountName - The storage account name",
					" * @param sasKey - The Shared Access Signature key",
					" * @returns- A Shared Access Signature token query string",
					" * {@link https://github.com/lfalck/AzureRestApiPostmanCollections GitHub}",
					" * ",
					" */",
					"function createStorageSASTokenQueryString(accountName, sasKey) {",
					"    if (!accountName || !sasKey) {",
					"        throw \"Missing required parameter\";",
					"    }",
					"",
					"    //Persmissions: Read, Write, Delete, List, Add, Create, Update, Process",
					"    const signedPermission = \"rwdlacup\";",
					"    const signedServices = \"bfqt\"; // Blob, File, Queue, Table",
					"    const signedResourceTypes = \"sco\"; // Service, Container, Object",
					"",
					"    //Dates need to be in yyyy-dd-MMTHH:mm:ssZ format",
					"    const now = new Date();",
					"    const minuteInMilliSeconds = 60000;",
					"    const signedStart = new Date(now.getTime() - minuteInMilliSeconds)",
					"        .toISOString()",
					"        .slice(0, 19) + \"Z\"; //Remove milliseconds",
					"    const signedExpiry = new Date(now.getTime() + minuteInMilliSeconds)",
					"        .toISOString()",
					"        .slice(0, 19) + \"Z\";",
					"",
					"    const signedIP = \"\";",
					"    const signedProtocol = \"https\";",
					"    const signedVersion = \"2017-04-17\";",
					"",
					"    const inputvalue =",
					"        `${accountName}\\n` +",
					"        `${signedPermission}\\n` +",
					"        `${signedServices}\\n` +",
					"        `${signedResourceTypes}\\n` +",
					"        `${signedStart}\\n` +",
					"        `${signedExpiry}\\n` +",
					"        `${signedIP}\\n` +",
					"        `${signedProtocol}\\n` +",
					"        `${signedVersion}\\n`;",
					"",
					"    const key = CryptoJS.enc.Base64.parse(sasKey);",
					"    let signature = CryptoJS.HmacSHA256(inputvalue, key);",
					"    signature = signature.toString(CryptoJS.enc.Base64);",
					"    signature = encodeURIComponent(signature);",
					"",
					"    // The full SAS token query string is added to the sv parameter to",
					"    // reduce the length of the request URI in Postman ",
					"    const uri =",
					"        /*?sv=*/`${signedVersion}&` +",
					"        `ss=${signedServices}&` +",
					"        `srt=${signedResourceTypes}&` +",
					"        `sp=${signedPermission}&` +",
					"        `se=${signedExpiry}&` +",
					"        `st=${signedStart}&` +",
					"        `spr=${signedProtocol}&` +",
					"        `sig=${signature}`;",
					"",
					"    return uri;",
					"}",
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "927b8013-707c-4f34-bc73-054bbaa667b7",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "ceec54fb-8d8a-4050-8459-a080028f5826",
			"key": "storageAccountName",
			"value": "Enter here or in an environment variable",
			"type": "text"
		},
		{
			"id": "2a25fad5-7155-4f9d-a69f-77520a68f671",
			"key": "storageSasKey",
			"value": "Enter here or in an environment variable",
			"type": "text"
		},
		{
			"id": "dcb4e45e-1d80-4a8f-bbee-aef936d9f2f2",
			"key": "storageQueueName",
			"value": "Need to be set in folder pre request script",
			"type": "text"
		},
		{
			"id": "5186ea93-3cdd-469f-86b7-c355ab5b5e53",
			"key": "storageContainerName",
			"value": "Need to be set in folder pre request script",
			"type": "text",
			"description": ""
		},
		{
			"id": "0aaedae6-ee0d-4541-98a7-ed4de53ff179",
			"key": "storageBlobName",
			"value": "Need to be set in folder pre request script",
			"type": "text",
			"description": ""
		},
		{
			"id": "c5aa47e8-8ecc-4056-81d1-0ba8a3c9ceaa",
			"key": "storageSasTokenQueryString",
			"value": "Automatically generated in collection pre request script",
			"type": "text"
		}
	]
}